<md-dialog flex="50">
  <form name="bookingForm">
    <div class="card">
      <div class="card-header" data-background-color="{{DATA_BACKGROUND_COLOR}}">
        <div class="md-toolbar-tools">        
          <span flex><h2>{{mixins._id ? 'Edit Booking' : 'New Booking'}}</h2> </span>
          <md-button class="md-icon-button" ng-click="cancel()">
             <md-icon md-svg-src="modules/core/client/img/icons/ic_close_24px.svg" aria-label="Close dialog"></md-icon>
          </md-button>
        </div>
        </div>
    </div>
    <md-dialog-content>
      <div class="md-dialog-content">

        <div layout="row" flex>
          <md-input-container flex>
            <label>Halls</label>
            <md-select style="text-transform: capitalize;"  multiple 
                        required
                        name="halls"
                        ng-model="mixins.mSelectedHalls"
                        ng-change="selectedHallsChanged()"
                        ng-model-options= "{trackBy: '$value._id'}">                
              <md-optgroup label="Halls">
                <md-option style="text-transform: capitalize;" ng-value="hall" ng-selected="{{ selectHallsByDefault(hall) }}" ng-repeat="hall in model.halls">{{hall.name}}</md-option>
              </md-optgroup>
            </md-select>
            {{changeCount}}
            <div ng-messages="bookingForm.halls.$error" ng-show="bookingForm.halls.$invalid  && submitted">
              <div ng-message="required">Halls is required.</div>
            </div>
          </md-input-container>

          <md-input-container flex=40>
            <label>Date</label>
            <input ng-model="ui.mSelectedDateToDisplay" onfocus="this.blur()" readonly/>
          </md-input-container>
        </div>

        <div layout="column" flex>
          <md-input-container flex>
              <label>Event</label>
              <md-select  style="text-transform: capitalize;" required
                          name="event"
                          ng-model="mixins.mSelectedEventType"
                          ng-change="onEventTypeSelected()">                
                <md-optgroup label="Event">
                  <md-option style="text-transform: capitalize;" ng-value="eventType" ng-selected="{{ eventType.name === mixins.mSelectedEventType.name ? 'true' : 'false' }}" ng-repeat="eventType in model.eventTypes">{{eventType.name}}</md-option>
                </md-optgroup>
              </md-select>    
              <div ng-messages="bookingForm.event.$error" ng-show="bookingForm.event.$invalid && submitted">
                <div ng-message="required">Event is required.</div>
              </div>
          </md-input-container>

          <md-input-container flex ng-if="mixins.mSelectedEventType === getOtherEvents() && getOtherEvents()">
            <input required name="otherEvent" ng-model="mixins.mOtherEvent" ng-pattern="mPattern"/>
            <div ng-messages="bookingForm.otherEvent.$error">
              <div ng-message="required">Other event is required.</div>
            </div>
          </md-input-container> 
             
        </div>

        <div layout="row" flex>
          <md-input-container flex>
            <label>Time</label>
              <div ng-click="showStartTimePicker($event)">
                <input class="form-control timepicker" required name="start" ng-model="eventTime.mStartToDisplay" onfocus="this.blur()" readonly></input>
              </div>
              <div ng-messages="bookingForm.start.$error">
                <div ng-message="required">Start time is required.</div>
                <div ng-message="lesser">Event start time should be less than end time.</div>
              </div>
          </md-input-container>

          <md-input-container flex>
            <label>To</label>
              <div ng-click="showEndTimePicker($event)">
                <input required name="end" ng-model="eventTime.mEndToDisplay" onfocus="this.blur()" readonly></input>
              </div>
              <div ng-messages="bookingForm.end.$error">
                <div ng-message="required">End time is required.</div>
                <div ng-message="greater">Event end time should be greater than start time.</div>
              </div>
          </md-input-container>
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Description</label>
            <textarea style="resize: none;" rows="3" ng-model="mixins.mDescription" ng-pattern="mPattern"></textarea> 
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Name</label>
            <input required name="name" ng-model="mixins.mName" ng-pattern="mPattern"/>
            <div ng-messages="bookingForm.name.$error">
              <div ng-message="required">Name is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Phone</label>
            <input type="text" required name="phone" ng-pattern="ui.mNumberPattern" ng-model="mixins.mPhone" min="0" ng-maxlength="10" />
            <div ng-messages="bookingForm.phone.$error">
              <div ng-message="required">Phone is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Email</label>
            <input type="email" name="email" ng-model="mixins.mEmail" ng-pattern="ui.mEmailPattern" />
            <div ng-messages="bookingForm.email.$error" role="alert">
              <div ng-message-exp="['pattern']">
                Invalid email.
              </div>
            </div>
          </md-input-container>  
        </div>
        
        <div layout="column" flex>
          <md-input-container flex>
            <label>Address</label>
            <textarea style="resize: none;" rows="3" ng-model="mixins.mAddress" ng-pattern="mPattern"></textarea> 
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Photo ID of the Person</label>
            <input ng-model="mixins.mPhotoId" ng-pattern="mPattern"/>
          </md-input-container>  
        </div>
                        
        <div layout="column" flex>
          <md-input-container flex>
            <label>Manager Name</label>
            <input required name="managerName" ng-model="mixins.mManagerName" ng-pattern="mPattern"/>
            <div ng-messages="bookingForm.managerName.$error">
              <div ng-message="required">Manager Name is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Basic Cost</label>
            <input required name="basicCost" ng-model="mixins.mBasicCost" type="number" min="{{ui.mMinBasicCost}}" ng-change="calculateBalanceDue()" ng-pattern="ui.mNumberPattern"/>
            <div ng-messages="bookingForm.basicCost.$error">
              <div ng-message="required">Basic cost is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Electricity Charges</label>
            <input required name="electricity" ng-model="mixins.mElectricityCharges" type="number" min="{{ui.mMinElectricityCharges}}" ng-change="calculateBalanceDue()" ng-pattern="ui.mNumberPattern"/>
            <div ng-messages="bookingForm.electricity.$error">
              <div ng-message="required">Electricity Charges is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Cleaning Charges</label>
            <input required name="cleaning" ng-model="mixins.mCleaningCharges" type="number" min="{{ui.mMinCleaningCharges}}" ng-change="calculateBalanceDue()" ng-pattern="ui.mNumberPattern"/>
            <div ng-messages="bookingForm.cleaning.$error">
              <div ng-message="required">Cleaning Charges is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Generator Charges</label>
            <input required name="generator" ng-model="mixins.mGeneratorCharges" type="number" min="0" ng-change="calculateBalanceDue()" ng-pattern="ui.mNumberPattern"/>
            <div ng-messages="bookingForm.generator.$error">
              <div ng-message="required">Generator Charges is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Miscellaneous Charges</label>
            <input required name="miscellaneous" ng-model="mixins.mMiscellaneousCharges" type="number" min="0" ng-change="calculateBalanceDue()" ng-pattern="ui.mNumberPattern"/>
            <div ng-messages="bookingForm.miscellaneous.$error">
              <div ng-message="required">Miscellaneous Charges is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Discount</label>
            <input required name="discount" ng-model="mixins.mDiscount" type="number" min="0" ng-change="calculateBalanceDue()" ng-pattern="ui.mNumberPattern"/>
            <div ng-messages="bookingForm.discount.$error">
              <div ng-message="required">Discount is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Sub Total</label>
            <input required name="subTotal" ng-model="mixins.mSubTotal" onfocus="this.blur()" type="number" readonly/>
            <div ng-messages="bookingForm.subTotal.$error">
              <div ng-message="required">Sub Total is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>CGST</label>
            <input required name="cgst" ng-model="mixins.mCGST" onfocus="this.blur()" type="number" readonly/>
            <div ng-messages="bookingForm.cgst.$error">
              <div ng-message="required">CGST is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>SGST</label>
            <input required name="sgst" ng-model="mixins.mSGST" onfocus="this.blur()" type="number" readonly/>
            <div ng-messages="bookingForm.sgst.$error">
              <div ng-message="required">SGST is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Grand Total</label>
            <input required name="grandTotal" ng-model="mixins.mGrandTotal" onfocus="this.blur()" type="number" readonly/>
            <div ng-messages="bookingForm.grandTotal.$error">
              <div ng-message="required">Grand Total is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
              <label>Payment Status</label>
              <md-select style="text-transform: capitalize;" required
                          name="payStatus" 
                          ng-model="mixins.mSelectedPaymentStatus">                
                <md-optgroup label="Payment Status">
                  <md-option style="text-transform: capitalize;" ng-value="paymentStatus" ng-selected="{{ paymentStatus.name === mixins.mSelectedPaymentStatus.name ? 'true' : 'false' }}" ng-repeat="paymentStatus in model.paymentStatuses">{{paymentStatus.name}}</md-option>
                </md-optgroup>
              </md-select>    
              <div ng-messages="bookingForm.payStatus.$error" ng-show="bookingForm.payStatus.$invalid && submitted">
                <div ng-message="required">Payment status is required.</div>
              </div>
          </md-input-container>             
        </div>         
       
        <div layout="column" flex>
            <label>Payment Received</label>  
            <div layout="row" flex>
              <md-input-container flex>
                <label>Amount Paid</label>
                <input ng-required="ui.createMode" name="amountPaid" ng-model="mPaymentHistory.amountPaid" type="number" min="1" ng-change="calculateBalanceDue()" ng-pattern="ui.mNumberPattern"/>
                <div ng-messages="bookingForm.amountPaid.$error">
                  <div ng-message="required">Amount paid is required.</div>
                </div>
              </md-input-container>  
              
              <md-input-container flex>
                <label>Paid Date</label>
                  <div ng-click="showPaidDatePicker($event)">
                    <input ng-required="ui.createMode" name="paidDate" ng-model="mPaymentHistory.paidDate" onfocus="this.blur()" readonly></input>
                  </div>                  
                  <div ng-messages="bookingForm.paidDate.$error">
                    <div ng-message="required">Paid date is required.</div>
                  </div>
              </md-input-container>

              <md-input-container flex>
                  <label>Payment Mode</label>
                  <md-select  ng-required="ui.createMode"
                              name="payMode"
                              ng-model="mPaymentHistory.paymentMode"
                              ng-change="onPaymentModeChanged()">                
                    <md-optgroup label="Payment Mode">
                      <md-option ng-value="paymentMode" ng-repeat="paymentMode in model.paymentModes">{{paymentMode}}</md-option>
                    </md-optgroup>
                  </md-select>    
                  <div ng-messages="bookingForm.payMode.$error" ng-show="bookingForm.payMode.$invalid && submitted">
                    <div ng-message="required">Payment mode is required.</div>
                  </div>
              </md-input-container>   
              <div class="pull-right" ng-if="!ui.createMode">
                <md-button class="md-raised md-primary nonecase" style="min-width: 50px" ng-click="addPayment()" ng-disabled="mPaymentHistory.amountPaid == null || mPaymentHistory.paidDate == null || mPaymentHistory.paymentMode == null" type="submit"><span class="glyphicon glyphicon-plus"></span></md-button>
              </div> 
            </div>
            <!-- Payment Histories -->
            <div ng-if="!ui.createMode" layout="row" flex ng-repeat="mPaymentHistory in mixins.mPaymentHistories track by $index">              
              <md-input-container flex>
                <label>Amount Paid</label>
                <input required name="amountPaid" ng-model="mPaymentHistory.amountPaid" type="number" min="1" ng-change="calculateBalanceDue()" ng-pattern="ui.mNumberPattern" ng-disabled="true"/>
                <div ng-messages="bookingForm.amountPaid.$error">
                  <div ng-message="required">Amount paid is required.</div>
                </div>
              </md-input-container>  
              
              <md-input-container flex>
                <label>Paid Date</label>
                  <div ng-click="showPaidDatePicker($event)">
                    <input required name="paidDate" ng-model="mPaymentHistory.paidDate | date:'dd/MM/yyyy'" onfocus="this.blur()" readonly ng-disabled="true"></input>
                  </div>                  
                  <div ng-messages="bookingForm.paidDate.$error">
                    <div ng-message="required">Paid date is required.</div>
                  </div>
              </md-input-container>

              <md-input-container flex>
                  <label>Payment Mode</label>
                  <md-select  required
                              name="payMode"
                              ng-model="mPaymentHistory.paymentMode"
                              ng-change="onPaymentModeChanged()" ng-disabled="true">                
                    <md-optgroup label="Payment Mode">
                      <md-option ng-value="paymentMode" ng-repeat="paymentMode in model.paymentModes">{{paymentMode}}</md-option>
                    </md-optgroup>
                  </md-select>    
                  <div ng-messages="bookingForm.payMode.$error" ng-show="bookingForm.payMode.$invalid && submitted">
                    <div ng-message="required">Payment mode is required.</div>
                  </div>
              </md-input-container>   
              <div class="pull-right">
                <md-button class="btn btn-danger btn-sm" style="min-width: 50px" ng-click="removePayment($index)" type="submit"><span class="glyphicon glyphicon-remove"></span></md-button>
              </div>
            </div>
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Balance Due</label>
            <input required name="balanceDue" ng-model="mixins.mBalanceDue" onfocus="this.blur()" type="number" min="0" step="any" readonly/>
            <div ng-messages="bookingForm.balanceDue.$error">
              <div ng-message="required">Balance Due is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div id="printHtml" ng-hide="{{true}}">
          <p ng-bind-html="trustAsHtml(htmlString)"></p>
        </div>
        
      </div>
    </md-dialog-content>

    <md-dialog-actions layout="row">  
      <md-button class="btn btn-next btn-fill btn-rose btn-wd" ng-disabled="bookingForm.$invalid" flex ng-click="submit(bookingForm, mFormActions[0])" type="submit">Print</md-button>
      <md-button class="btn btn-next btn-fill btn-primary btn-wd" ng-disabled="bookingForm.$invalid" flex ng-click="sendMail()" type="submit">Email</md-button>
      <md-button class="btn btn-next btn-fill btn-info btn-wd" ng-disabled="bookingForm.$invalid" flex ng-click="save(bookingForm)" type="submit">Confirm Booking</md-button>
    </md-dialog-actions>
  </form>
</md-dialog>