<md-dialog flex>
  <form name="userForm">
    <div class="card">
      <div class="card-header" data-background-color="{{DATA_BACKGROUND_COLOR}}">
        <div class="md-toolbar-tools">        
          <span flex><h2>New Booking</h2> </span>
          <md-button class="md-icon-button" ng-click="cancel()">
             <md-icon md-svg-src="modules/core/client/img/icons/ic_close_24px.svg" aria-label="Close dialog"></md-icon>
          </md-button>
        </div>
        </div>
    </div>
    <md-dialog-content>
      <div class="md-dialog-content">

        <div layout="row" flex>
          <md-input-container flex>
            <label>Halls</label>
            <md-select style="text-transform: capitalize;"  multiple 
                        required
                        name="halls"
                        ng-model="mixins.mSelectedHalls"
                        ng-change="selectedHallsChanged()">                
              <md-optgroup label="Halls">
                <md-option style="text-transform: capitalize;" ng-value="hall" ng-repeat="hall in model.halls">{{hall.name}}</md-option>
              </md-optgroup>
            </md-select>
            <div ng-messages="userForm.halls.$error" ng-show="userForm.halls.$invalid  && submitted">
              <div ng-message="required">Halls is required.</div>
            </div>
          </md-input-container>

          <md-input-container flex=40>
            <label>Date</label>
            <input ng-model="ui.mSelectedDateToDisplay" onfocus="this.blur()" readonly/>
          </md-input-container>
        </div>

        <div layout="column" flex>
          <md-input-container flex>
              <label>Event</label>
              <md-select  style="text-transform: capitalize;" required
                          name="event"
                          ng-model="mixins.mSelectedEventType"
                          ng-change="onEventTypeSelected()">                
                <md-optgroup label="Event">
                  <md-option style="text-transform: capitalize;" ng-value="eventType" ng-repeat="eventType in model.eventTypes">{{eventType.name}}</md-option>
                </md-optgroup>
              </md-select>    
              <div ng-messages="userForm.event.$error" ng-show="userForm.event.$invalid && submitted">
                <div ng-message="required">Event is required.</div>
              </div>
          </md-input-container>

          <md-input-container flex ng-if="mixins.mSelectedEventType === getOtherEvents() && getOtherEvents()">
            <input required name="otherEvent" ng-model="mixins.mOtherEvent" ng-pattern="mPattern"/>
            <div ng-messages="userForm.otherEvent.$error">
              <div ng-message="required">Other event is required.</div>
            </div>
          </md-input-container> 
             
        </div>

        <div layout="row" flex>
          <md-input-container flex>
            <label>Time</label>
              <div ng-click="showStartTimePicker($event)">
                <input class="form-control timepicker" required name="start" ng-model="eventTime.mStartToDisplay" onfocus="this.blur()" readonly></input>
              </div>
              <div ng-messages="userForm.start.$error">
                <div ng-message="required">Start time is required.</div>
                <div ng-message="lesser">Event start time should be less than end time.</div>
              </div>
          </md-input-container>

          <md-input-container flex>
            <label>To</label>
              <div ng-click="showEndTimePicker($event)">
                <input required name="end" ng-model="eventTime.mEndToDisplay" onfocus="this.blur()" readonly></input>
              </div>
              <div ng-messages="userForm.end.$error">
                <div ng-message="required">End time is required.</div>
                <div ng-message="greater">Event end time should be greater than start time.</div>
              </div>
          </md-input-container>
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Description</label>
            <textarea style="resize: none;" rows="3" ng-model="mixins.mDescription" ng-pattern="mPattern"></textarea> 
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Name</label>
            <input required name="name" ng-model="mixins.mName" ng-pattern="mPattern"/>
            <div ng-messages="userForm.name.$error">
              <div ng-message="required">Name is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Phone</label>
            <input type="number" required name="phone" ng-model="mixins.mPhone" min="0" ng-maxlength="10" />
            <div ng-messages="userForm.phone.$error">
              <div ng-message="required">Phone is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Email</label>
            <input type="email" name="email" ng-model="mixins.mEmail" ng-pattern="/^.+@.+\..+$/" />
            <div ng-messages="userForm.email.$error" role="alert">
              <div ng-message-exp="['pattern']">
                Invalid email.
              </div>
            </div>
          </md-input-container>  
        </div>
        
        <div layout="column" flex>
          <md-input-container flex>
            <label>Address</label>
            <textarea style="resize: none;" rows="3" ng-model="mixins.mAddress" ng-pattern="mPattern"></textarea> 
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Photo ID of the Person</label>
            <input ng-model="mixins.mPhotoId" ng-pattern="mPattern"/>
          </md-input-container>  
        </div>
        
        <div layout="column" flex>
          <md-input-container flex>
              <label>Payment Status</label>
              <md-select style="text-transform: capitalize;" required
                          name="payStatus" 
                          ng-model="mixins.mSelectedPaymentStatus"
                          ng-change="onPaymentStatusChanged()">                
                <md-optgroup label="Payment Status">
                  <md-option style="text-transform: capitalize;" ng-value="paymentStatus" ng-repeat="paymentStatus in model.paymentStatuses">{{paymentStatus.name}}</md-option>
                </md-optgroup>
              </md-select>    
              <div ng-messages="userForm.payStatus.$error" ng-show="userForm.payStatus.$invalid && submitted">
                <div ng-message="required">Payment status is required.</div>
              </div>
          </md-input-container>             
        </div>

        <div layout="column" flex>
          <md-input-container flex>
              <label>Payment Mode</label>
              <md-select 
                          required
                          name="payMode"
                          ng-model="mixins.mSelectedPaymentMode"
                          ng-change="onPaymentModeChanged()">                
                <md-optgroup label="Payment Mode">
                  <md-option ng-value="paymentMode" ng-repeat="paymentMode in model.paymentModes">{{paymentMode}}</md-option>
                </md-optgroup>
              </md-select>    
              <div ng-messages="userForm.payMode.$error" ng-show="userForm.payMode.$invalid && submitted">
                <div ng-message="required">Payment mode is required.</div>
              </div>
          </md-input-container>             
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Manager Name</label>
            <input required name="managerName" ng-model="mixins.mManagerName" ng-pattern="mPattern"/>
            <div ng-messages="userForm.managerName.$error">
              <div ng-message="required">Manager Name is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Rent</label>
            <input required name="rent" ng-model="mixins.mRent" type="number" onfocus="this.blur()" readonly/>
            <div ng-messages="userForm.rent.$error">
              <div ng-message="required">Rent is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Electricity Charges</label>
            <input required name="electricity" ng-model="mixins.mElectricityCharges" type="number" min="0" ng-change="calculateBalanceDue()" ng-pattern="mNumberPattern"/>
            <div ng-messages="userForm.electricity.$error">
              <div ng-message="required">Electricity Charges is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Cleaning Charges</label>
            <input required name="cleaning" ng-model="mixins.mCleaningCharges" type="number" min="0" ng-change="calculateBalanceDue()" ng-pattern="mNumberPattern"/>
            <div ng-messages="userForm.cleaning.$error">
              <div ng-message="required">Cleaning Charges is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Generator Charges</label>
            <input required name="generator" ng-model="mixins.mGeneratorCharges" type="number" min="0" ng-change="calculateBalanceDue()" ng-pattern="mNumberPattern"/>
            <div ng-messages="userForm.generator.$error">
              <div ng-message="required">Generator Charges is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Miscellaneous Charges</label>
            <input required name="miscellaneous" ng-model="mixins.mMiscellaneousCharges" type="number" min="0" ng-change="calculateBalanceDue()" ng-pattern="mNumberPattern"/>
            <div ng-messages="userForm.miscellaneous.$error">
              <div ng-message="required">Miscellaneous Charges is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Discount</label>
            <input required name="discount" ng-model="mixins.mDiscount" type="number" min="0" ng-change="calculateBalanceDue()" ng-pattern="mNumberPattern"/>
            <div ng-messages="userForm.discount.$error">
              <div ng-message="required">Discount is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Sub Total</label>
            <input required name="subTotal" ng-model="mixins.mSubTotal" onfocus="this.blur()" type="number" readonly/>
            <div ng-messages="userForm.subTotal.$error">
              <div ng-message="required">Sub Total is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>CGST</label>
            <input required name="cgst" ng-model="mixins.mCGST" onfocus="this.blur()" type="number" readonly/>
            <div ng-messages="userForm.cgst.$error">
              <div ng-message="required">CGST is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>SGST</label>
            <input required name="sgst" ng-model="mixins.mSGST" onfocus="this.blur()" type="number" readonly/>
            <div ng-messages="userForm.sgst.$error">
              <div ng-message="required">SGST is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Grand Total</label>
            <input required name="grandTotal" ng-model="mixins.mGrandTotal" onfocus="this.blur()" type="number" readonly/>
            <div ng-messages="userForm.grandTotal.$error">
              <div ng-message="required">Grand Total is required.</div>
            </div>
          </md-input-container>  
        </div>

         <div layout="column" flex>
          <md-input-container flex>
            <label>Advance Received</label>
            <input required name="advanceReceived" ng-model="mixins.mAdvanceReceived" type="number" min="0" ng-change="calculateBalanceDue()" ng-pattern="mNumberPattern"/>
            <div ng-messages="userForm.advanceReceived.$error">
              <div ng-message="required">Advance Received is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div layout="column" flex>
          <md-input-container flex>
            <label>Balance Due</label>
            <input required name="balanceDue" ng-model="mixins.mBalanceDue" onfocus="this.blur()" type="number" step="any" readonly/>
            <div ng-messages="userForm.balanceDue.$error">
              <div ng-message="required">Balance Due is required.</div>
            </div>
          </md-input-container>  
        </div>

        <div id="printHtml" ng-hide="{{true}}">
          <p ng-bind-html="trustAsHtml(htmlString)"></p>
        </div>
        
      </div>
    </md-dialog-content>

    <md-dialog-actions layout="row">  
      <md-button class="btn btn-next btn-fill btn-rose btn-wd" ng-disabled="userForm.$invalid" flex ng-click="submit(userForm, mFormActions[0])" type="submit">Print</md-button>
      <md-button class="btn btn-next btn-fill btn-primary btn-wd" ng-disabled="userForm.$invalid" flex ng-click="submit(userForm, mFormActions[1])" type="submit">Email</md-button>
      <md-button class="btn btn-next btn-fill btn-info btn-wd" ng-disabled="userForm.$invalid" flex ng-click="save(userForm)" type="submit">Confirm Booking</md-button>
    </md-dialog-actions>
  </form>
</md-dialog>